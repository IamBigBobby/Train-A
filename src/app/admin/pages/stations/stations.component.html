<div class="tui-container">
  <div class="stations-top-info">
    <div id="map"></div>
    <form class="stations-top-info__form" [formGroup]="stationForm" (ngSubmit)="createStation()">
      <tui-input formControlName="city">
        City
        <input tuiTextfieldLegacy type="text" />
      </tui-input>
      <tui-input formControlName="latitude">
        Latitude
        <input tuiTextfieldLegacy placeholder="enter latitude" type="text" (change)="onCoordinatesChange()" />
      </tui-input>
      <tui-input formControlName="longitude">
        Longitude
        <input tuiTextfieldLegacy placeholder="enter longitude" type="text" (change)="onCoordinatesChange()" />
      </tui-input>
      <div class="station__connect-to-container" formArrayName="connections">
        @for (connectItem of connections.controls; track connectItem; let i = $index) {
          <tui-select
            tuiTextfieldSize="m"
            class="tui-space_vertical-4"
            [formControlName]="i"
            (ngModelChange)="onSelectChange(i)"
          >
            Connect to
            <input placeholder="select city" tuiTextfieldLegacy />
            @let stations = citysNames$ | async;
            @if (stations) {
              <tui-data-list-wrapper *tuiDataList [items]="stations">
                <ng-template tuiDataListItem let-item>
                  {{ item }}
                </ng-template>
              </tui-data-list-wrapper>
            }
          </tui-select>
        }
      </div>
      <button size="l" tuiButton>Add station</button>
    </form>
  </div>
  <div class="stations-bottom-info">
    @let stations = stations$ | async;
    @if (stations) {
      @for (station of stations; track station) {
        <div class="stations-bottom-info__card">
          <div class="stations-bottom-info__card-name">{{ station.city }}</div>
          <div class="stations-bottom-info__lat">latitude: {{ station.latitude }}</div>
          <div class="stations-bottom-info__lng">longitude: {{ station.longitude }}</div>
          <div class="stations-bottom-info__connect-to">
            <span class="stations-bottom-info__connect-to-header">Connect to: </span><br />
            @for (connectedStation of station.connectedTo; track connectedStation) {
              @if (connectedStation) {
                @let cityConnectedName = getStationNameById(connectedStation.id) | async;
                @if (cityConnectedName) {
                  <span>{{ cityConnectedName }} </span>
                }
              }
            }
          </div>
        </div>
      }
    }
  </div>
</div>
