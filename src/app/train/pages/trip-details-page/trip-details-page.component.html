<ng-container *ngIf="rideInformation$ | async as rideInfo">
  <ng-container *ngIf="routeDetails$ | async as routeDetails">
    <div class="header">
      <button tuiAppBarBack tuiSlot="left" (click)="goBack()" class="button-back">Back</button>

      <div>
        <div class="tui-text_body-l-1">
          {{ rideInfo.path[0] }} â†’ {{ rideInfo.path.at(-1) }},
          {{ rideInfo.schedule.segments[0].time[0] | date: 'MMM d, h:mm a' }}
        </div>

        <div class="ride">
          Ride {{ rideInfo.rideId }}
          <button tuiButton (click)="showDialog($event)" size="s" appearance="outline">Route</button>
        </div>
      </div>
    </div>

    <div class="content">
      <div>
        <tui-segmented>
          <button
            *ngFor="let carriage of routeDetails.carriages | uniqueCarriages"
            (click)="onCarriageSelected(carriage)"
          >
            <p>{{ carriage }}: {{ getAvailableSeatsCountForCarriage(carriage) }}</p>
            <p>{{ rideInfo.schedule | sumCarriagePrice: carriage | currency: 'USD' : 'symbol' }}</p>
          </button>
        </tui-segmented>
      </div>

      <div class="carriage-info">
        <div class="carriages">
          <ng-container *ngFor="let carriage of routeDetails.carriages; let carriageIndex = index">
            <div
              *ngIf="!selectedCarriage || carriage === selectedCarriage"
              class="carriage-item"
              [attr.data-carriage-index]="carriageIndex"
            >
              <app-carriage
                [carriagesData]="getCarriageData(carriage)"
                (seatSelected)="onSeatSelected($event, carriageIndex)"
                [occupiedSeats]="getOccupiedSeatsForCarriage(carriageIndex)"
              ></app-carriage>
            </div>
          </ng-container>
        </div>

        <div class="booking">
          <div class="booking-info">
            <span *ngIf="selectedSeat">{{ selectedCarriage }}, Seat {{ selectedSeat }}</span
            ><span *ngIf="selectedSeat">$1000</span>
          </div>
          <button tuiButton (click)="bookSeat()" [disabled]="selectedSeat === null">Book seat</button>
        </div>
      </div>

      <div class="legend-container">
        <app-legend
          [reservedSeats]="occupiedSeats.length"
          [availableSeats]="availableSeatsCount"
          [selectedSeats]="selectedSeat ? 1 : 0"
        ></app-legend>
      </div>
    </div>
  </ng-container>
</ng-container>

<ng-template #notFound>
  <p>Ride not found.</p>
</ng-template>
