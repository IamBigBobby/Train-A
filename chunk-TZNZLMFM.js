import{a as N}from"./chunk-HUAJONC7.js";import{b as ee}from"./chunk-WNQC6ED5.js";import{b as Z}from"./chunk-QJ4XV6RO.js";import{Wa as W,q as z}from"./chunk-YPPQXWD3.js";import{o as K,p as X}from"./chunk-RR4QGK55.js";import{b as Y,e as G,f as J}from"./chunk-EH7XB44O.js";import{A as U,Bb as E,Ca as w,Cb as $,Db as s,Eb as c,Fb as C,Jb as D,M as H,Ma as I,Mb as A,Na as v,Nb as o,Sb as R,Tb as y,Ub as h,Uc as j,Wb as l,Xb as Q,Xc as V,Yb as P,bc as b,cc as T,db as d,dc as _,fc as F,ha as q,lc as B,mc as k,t as S,tb as p,ub as u,va as M,vb as x,yb as m}from"./chunk-2XEAWUUP.js";import"./chunk-T527G4PA.js";var de=i=>i,te=X(de,i=>i.riderListState.riderList);var le=["timeInputDepart"],me=["timeInputArrive"],_e=["carriageInput"],pe=["carriageName"],ue=(i,n)=>n.time[0],xe=(i,n)=>n[0];function Ce(i,n){if(i&1&&(s(0,"div"),l(1),c()),i&2){let e=o();d(),P("Ride ",e.idRide,"")}}function ge(i,n){if(i&1&&(s(0,"div",6),l(1),c()),i&2){let e=o(2);d(),P(" ",e.getCityById(e.cityRide[e.rideSchedule.length])," ")}}function fe(i,n){if(i&1&&C(0,"input",10,0),i&2){let e=o(3).$index,t=_(0),r=o();x("value",r.formatToDateTimeLocal(t.segments[e].time[0])),u("data-index",e)}}function Ie(i,n){if(i&1&&C(0,"input",10,1),i&2){let e=o(3).$index,t=_(0),r=o();x("value",r.formatToDateTimeLocal(t.segments[e].time[1])),u("data-index",e)}}function ve(i,n){if(i&1&&(s(0,"div",11)(1,"span"),l(2,"arrive"),c(),C(3,"input",10,1),c(),s(5,"div",12)(6,"span"),l(7,"depart "),c(),C(8,"input",10,0),c()),i&2){let e=o(3).$index,t=_(0),r=o();d(3),x("value",r.formatToDateTimeLocal(t.segments[e-1].time[1])),u("data-index",e),d(5),x("value",r.formatToDateTimeLocal(t.segments[e].time[0])),u("data-index",e)}}function Re(i,n){if(i&1&&p(0,fe,2,2,"input",10)(1,Ie,2,2,"input",10)(2,ve,10,4),i&2){let e=o(2).$index,t=o();m(e===0?0:e===t.rideSchedule.length-1?1:2)}}function ye(i,n){if(i&1&&p(0,Re,3,1),i&2){o();let e=_(0);m(e?0:-1)}}function he(i,n){if(i&1&&C(0,"input",13,0),i&2){let e=o(3).$index,t=_(0),r=o();x("value",r.formatToDateTimeLocal(t.segments[e].time[0]))("disabled",!0),u("data-index",e)}}function be(i,n){if(i&1&&C(0,"input",13,1),i&2){let e=o(3).$index,t=_(0),r=o();x("value",r.formatToDateTimeLocal(t.segments[e].time[1]))("disabled",!0),u("data-index",e)}}function Te(i,n){if(i&1&&(s(0,"div",11)(1,"span"),l(2,"arrive"),c(),C(3,"input",13,1),c(),s(5,"div",12)(6,"span"),l(7,"depart "),c(),C(8,"input",13,0),c()),i&2){let e=o(3).$index,t=_(0),r=o();d(3),x("value",r.formatToDateTimeLocal(t.segments[e-1].time[1]))("disabled",!0),u("data-index",e),d(5),x("value",r.formatToDateTimeLocal(t.segments[e].time[0]))("disabled",!0),u("data-index",e)}}function Se(i,n){if(i&1&&p(0,he,2,3,"input",13)(1,be,2,3,"input",13)(2,Te,10,6),i&2){let e=o(2).$index,t=o();m(e===0?0:e===t.rideSchedule.length-1?1:2)}}function Ee(i,n){if(i&1&&p(0,Se,3,1),i&2){o();let e=_(0);m(e?0:-1)}}function $e(i,n){if(i&1){let e=D();s(0,"button",14),A("click",function(){I(e);let r=o().$index,a=o();return v(a.toggleEditTime(r))}),l(1,"Edit"),c()}}function De(i,n){if(i&1){let e=D();s(0,"button",15),A("click",function(){I(e);let r=o().$index,a=o();return v(a.toggleEditTime(r))})("click",function(){I(e);let r=o().$index,a=o();return v(a.saveRide(r))}),l(1,"Save"),c()}}function Ae(i,n){if(i&1&&(s(0,"div",16)(1,"div",16)(2,"span",null,2),l(4),c(),C(5,"input",17,3),c()()),i&2){let e=o().$implicit,t=o(2).$index;d(2),u("data-index",t),d(2),Q(e[0]),d(),x("value",e[1])("disabled",!0),u("data-index",t)}}function Le(i,n){if(i&1&&(s(0,"div",16)(1,"span",null,2),l(3),c(),C(4,"input",18,3),c()),i&2){let e=o().$implicit,t=o(2).$index;d(),u("data-index",t),d(2),Q(e[0]),d(),x("value",e[1]),u("data-index",t)}}function we(i,n){if(i&1&&p(0,Ae,7,5,"div",16)(1,Le,6,4,"div",16),i&2){let e=o(2).$index,t=o();m(t.isEditingPrice[e]?t.isEditingPrice[e]?1:-1:0)}}function Pe(i,n){if(i&1){let e=D();s(0,"button",14),A("click",function(){I(e);let r=o(2).$index,a=o();return v(a.toggleEditPrice(r))}),l(1,"Edit"),c()}}function Fe(i,n){if(i&1){let e=D();s(0,"button",15),A("click",function(){I(e);let r=o(2).$index,a=o();return v(a.toggleEditPrice(r))})("click",function(){I(e);let r=o(2).$index,a=o();return v(a.saveRide(r))}),l(1,"Save"),c()}}function Be(i,n){if(i&1&&(b(0),E(1,we,2,1,null,null,xe),p(3,Pe,2,0,"button",8)(4,Fe,2,0,"button")),i&2){let e=o().$index,t=_(0),r=o(),a=r.getCarriagePriceArray(t.segments[e].price);d(),$(a),d(2),m(r.isEditingPrice[e]?r.isEditingPrice[e]?4:-1:3)}}function ke(i,n){if(i&1&&(b(0),s(1,"div",4)(2,"div",5)(3,"div",6),l(4),c(),p(5,ge,2,1,"div",6),c(),s(6,"div",7),p(7,ye,1,1)(8,Ee,1,1)(9,$e,2,0,"button",8)(10,De,2,0,"button"),c(),s(11,"div",9),p(12,Be,5,1),c()()),i&2){let e=n.$index,t=o(),r=T(t.findSegmentByRiderId(t.idRide));d(4),P(" ",t.getCityById(t.cityRide[e])," "),d(),m(e===t.rideSchedule.length-1?5:-1),d(2),m(t.isEditingTime[e]?7:t.isEditingTime[e]?-1:8),d(2),m(t.isEditingTime[e]?t.isEditingTime[e]?10:-1:9),d(3),m(r?12:-1)}}var O=class i{rideInfo;routeId;rideSchedule;idRide;cityRide;carriageRide;stationDataAllUpd;carriagesDataAllUpd;isEditingPrice=[];isEditingTime=[];timeInputsDepart;timeInputsArrive;carriageInputs;carriageName;ngOnInit(){this.isEditingPrice=new Array(this.rideSchedule.length).fill(!1),this.isEditingTime=new Array(this.rideSchedule.length).fill(!1)}toggleEditPrice(n){this.isEditingPrice[n]=!this.isEditingPrice[n]}toggleEditTime(n){this.isEditingTime[n]=!this.isEditingTime[n]}formatToDateTimeLocal(n){let e=new Date(n),t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),g=e.getHours().toString().padStart(2,"0"),f=e.getMinutes().toString().padStart(2,"0");return`${t}-${r}-${a}T${g}:${f}`}getCarriagePriceArray(n){return Object.entries(n)}getCityById(n){if(this.stationDataAllUpd){let e=this.stationDataAllUpd.find(t=>t.id===n);return e?e.city:""}return""}getCarriageByCode(n){if(this.carriagesDataAllUpd){let e=this.carriagesDataAllUpd.find(t=>t.code===n);return e?e.name:""}return""}findSegmentByRiderId(n){return this.rideInfo.schedule.find(e=>e.rideId===n)}saveRide(n){let e=this.getValuesByIndex(this.timeInputsDepart,n,"data-index"),t=this.getValuesByIndex(this.timeInputsArrive,n,"data-index"),r=this.getValuesByIndex(this.timeInputsDepart,n-1,"data-index"),a=this.getValuesByIndex(this.timeInputsDepart,n+1,"data-index"),g=this.getValuesByIndex(this.carriageInputs,n,"data-index"),f=this.getValuesByIndex(this.carriageInputs,n-1,"data-index"),L=this.getTextContentByIndex(this.carriageName,n,"data-index"),ne=[...t,...r],re=[...e,...a],oe=this.mapCarriagePrices(L,f),ae=this.mapCarriagePrices(L,g);console.log("prev time",ne),console.log("time",re),console.log("prev price",oe),console.log("carriage price",ae)}mapCarriagePrices(n,e){let t=n.filter(a=>a!==null),r={};for(let a=0;a<t.length;a+=1){let g=t[a];r[g]=Number(e[a])}return r}getValuesByIndex(n,e,t){return n.filter(r=>parseInt(r.nativeElement.getAttribute(t)||"",10)===e).map(r=>r.nativeElement.value)}getTextContentByIndex(n,e,t){return n.filter(r=>parseInt(r.nativeElement.getAttribute(t)||"",10)===e).map(r=>r.nativeElement.textContent)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-ride-card"]],viewQuery:function(e,t){if(e&1&&(R(le,5),R(me,5),R(_e,5),R(pe,5)),e&2){let r;y(r=h())&&(t.timeInputsDepart=r),y(r=h())&&(t.timeInputsArrive=r),y(r=h())&&(t.carriageInputs=r),y(r=h())&&(t.carriageName=r)}},inputs:{rideInfo:"rideInfo",routeId:"routeId",rideSchedule:"rideSchedule",idRide:"idRide",cityRide:"cityRide",carriageRide:"carriageRide",stationDataAllUpd:"stationDataAllUpd",carriagesDataAllUpd:"carriagesDataAllUpd"},standalone:!0,features:[F],decls:3,vars:1,consts:[["timeInputDepart",""],["timeInputArrive",""],["carriageName",""],["carriageInput",""],[1,"ride-card__container"],[1,"ride-card__city"],[1,"ride-card__city-element"],[1,"ride-card__time"],[1,"ride-card__edit-carriage"],[1,"ride-card__carriage"],["type","datetime-local",1,"ride-card__time-input",3,"value"],[1,"ride-card__time-input_arrive"],[1,"ride-card__time-input_depart"],["type","datetime-local",1,"ride-card__time-input",3,"value","disabled"],[1,"ride-card__edit-carriage",3,"click"],[3,"click"],[1,"ride-card__cariage-element"],["type","number",1,"ride-card__carriage-input",3,"value","disabled"],["type","number",1,"ride-card__carriage-input",3,"value"]],template:function(e,t){e&1&&(p(0,Ce,2,1,"div"),E(1,ke,13,6,"div",4,ue)),e&2&&(m(t.rideSchedule?0:-1),d(),$(t.rideSchedule))},dependencies:[V,z],styles:[".ride-card__container[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:space-around;border:1px solid red}.ride-card__container__city[_ngcontent-%COMP%], .ride-card__container__time[_ngcontent-%COMP%], .ride-card__container__carriage[_ngcontent-%COMP%]{display:flex;width:30vw}.ride-card__carriage-input[_ngcontent-%COMP%]{width:50px}"]})};var Ve=["addRideButton"],Oe=(i,n)=>n.rideId;function Me(i,n){if(i&1&&C(0,"app-ride-card",3),i&2){let e=o().$implicit,t=o(2),r=_(5),a=_(7),g=_(9);x("carriagesDataAllUpd",g)("stationDataAllUpd",a)("cityRide",r.path)("idRide",e.rideId)("rideSchedule",e.segments)("carriageRide",r.carriages)("rideInfo",r)("routeId",t.routeId)}}function Qe(i,n){if(i&1&&p(0,Me,1,8,"app-ride-card",3),i&2){let e=n.$implicit;m(e.rideId?0:-1)}}function Ne(i,n){if(i&1&&E(0,Qe,1,1,null,null,Oe),i&2){o();let e=_(5);$(e.schedule)}}var ie=class i{defaultCarriagePrice=1e3;addRideButton;route=M(Y);store=M(K);addRideButtonSubscription;routeId=Number(this.route.snapshot.params.id);stationArr$=this.store.select(ee);carriagesArr$=this.store.select(Z);riderInfo$=this.store.select(te);defaultRideSchedule$=this.riderInfo$.pipe(S(n=>{let e=new Date().getTime(),t=n.path.length,r=Array.from(new Set(n.carriages)),a={},g=1e3*60*60*2;return r.forEach(f=>{a[f]=this.defaultCarriagePrice}),{segments:new Array(t-1).fill(null).map(()=>{e+=2*g;let f=new Date(e).toISOString(),L=new Date(e+g).toISOString();return{time:[f,L],price:a}})}}));ngOnInit(){this.store.dispatch(N.loadRiderList({idRoute:this.routeId}))}ngAfterViewInit(){this.createAddRideSubscription()}ngOnDestroy(){this.addRideButtonSubscription?.unsubscribe()}createAddRideSubscription(){this.addRideButton&&(this.addRideButtonSubscription=U(this.addRideButton.nativeElement,"click").pipe(q(()=>this.defaultRideSchedule$.pipe(H(1),S(n=>this.store.dispatch(N.createRide({routeId:this.routeId,scheduleItem:n})))))).subscribe())}getCitiesByIds(n){return this.stationArr$.pipe(S(e=>e.filter(t=>n.includes(t.id))))}getCarriagesByCode(n){return this.carriagesArr$.pipe(S(e=>e.filter(t=>{t.code&&n.includes(t.code)})))}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=w({type:i,selectors:[["app-ride"]],viewQuery:function(e,t){if(e&1&&R(Ve,7),e&2){let r;y(r=h())&&(t.addRideButton=r.first)}},standalone:!0,features:[F],decls:12,vars:10,consts:[["addRideButton",""],["routerLinkActive","active","ariaCurrentWhenActive","page","routerLink","/admin/routes","size","s","tuiButton",""],["size","s","tuiButton",""],[3,"carriagesDataAllUpd","stationDataAllUpd","cityRide","idRide","rideSchedule","carriageRide","rideInfo","routeId"]],template:function(e,t){if(e&1&&(s(0,"button",1),l(1,` Back to routes
`),c(),s(2,"button",2,0),l(4,"Add ride"),c(),b(5),B(6,"async"),b(7),B(8,"async"),b(9),B(10,"async"),p(11,Ne,2,0)),e&2){d(5);let r=T(k(6,1,t.riderInfo$));d(2);let a=T(k(8,4,t.stationArr$));d(2);let g=T(k(10,7,t.carriagesArr$));d(2),m(r&&a&&g&&r?11:-1)}},dependencies:[W,G,J,V,j,O]})};export{ie as RideComponent};
