import{b as mt}from"./chunk-6RWEUSYO.js";import{a as T}from"./chunk-AWJUURLK.js";import{a as ct}from"./chunk-T3A2JJNJ.js";import{a as K,b as Q,c as X,d as Y}from"./chunk-OVLN55NL.js";import{f as ut}from"./chunk-RLCBV7EY.js";import{F as J,J as Z}from"./chunk-7DOSCQIA.js";import"./chunk-ZV7KZKEA.js";import{h as H}from"./chunk-2FEQR2WY.js";import"./chunk-ZGX5YXHD.js";import{gb as b,m as B,n as N,p,r as L,s as j,t as G,u as z,v as W,x as q}from"./chunk-V43RW7AC.js";import{m as A,n as lt}from"./chunk-H4NAPNW2.js";import{$b as v,Ab as a,Ba as y,Bb as n,Cb as C,Gb as x,Jb as m,Jc as $,Ka as d,Kb as l,La as _,Mc as w,Q as st,Sa as P,Tb as c,Vb as U,Zb as E,_b as V,bb as u,bc as S,gc as O,hc as k,qb as g,sb as f,t as rt,ua as h,vb as R,wb as ot,xb as I,yb as D,zb as F}from"./chunk-FW5WJFJQ.js";import"./chunk-T527G4PA.js";var _t=i=>i,pt=lt(_t,i=>i.routesState.routesList);function Dt(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=l(2);f("items",t.processedStationData)}}function Ft(i,e){if(i&1){let t=x();a(0,"div",3)(1,"tui-select",7),m("ngModelChange",function(){let o=d(t).$index,s=l();return _(s.onSelectChangeStation(o))}),c(2," City "),C(3,"input",8),g(4,Dt,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=d(t).$index,s=l();return _(s.removeStation(o))}),c(6,"delete"),n()()}if(i&2){let t=e.$index;u(),f("formControlName",t)}}function vt(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=l(2);f("items",t.processedCarriagesData)}}function yt(i,e){if(i&1){let t=x();a(0,"div",5)(1,"tui-select",7),m("ngModelChange",function(){let o=d(t).$index,s=l();return _(s.onSelectChangeCarriages(o))}),c(2," Carriage "),C(3,"input",8),g(4,vt,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=d(t).$index,s=l();return _(s.removeCarriage(o))}),c(6,"delete"),n()()}if(i&2){let t=e.$index;u(),f("formControlName",t)}}var tt=class i{routeData;stationDataAllUpd;carriagesDataAllUpd;formClosed=new P;store=h(A);formBuilder=h(W);updRouteForm=this.formBuilder.group({stations:this.formBuilder.array([new p(null)]),carriages:this.formBuilder.array([new p(null)])});ngOnInit(){this.setInitialValues()}get stations(){return this.updRouteForm.get("stations")}get carriages(){return this.updRouteForm.get("carriages")}get processedStationData(){return this.stationDataAllUpd?this.stationDataAllUpd.map(e=>e.city):null}get processedCarriagesData(){return this.carriagesDataAllUpd?this.carriagesDataAllUpd.map(e=>e.name):null}onSelectChangeStation(e){e===this.stations.length-1&&this.stations.push(new p(null))}onSelectChangeCarriages(e){e===this.carriages.length-1&&this.carriages.push(new p(null))}removeStation(e){this.stations.length>1&&this.stations.removeAt(e)}removeCarriage(e){this.carriages.length>1&&this.carriages.removeAt(e)}createRoute(){let e=this.mutateStations(Array.from(new Set(this.updRouteForm.get("stations")?.value.slice(0,-1)))),t=this.mutateCarriages(this.updRouteForm.get("carriages")?.value.filter(o=>o!==null));if(e.length<=1){alert("add at least two stations");return}if(t.length===0){alert("add at least one carriages");return}let r={path:e,carriages:t};this.routeData.id&&this.store.dispatch(T.updateRoute({idRoute:this.routeData.id,updRoute:r})),this.closeForm(),this.resetForm()}mutateStations(e){let t=[];if(this.stationDataAllUpd)for(let r of this.stationDataAllUpd)e.includes(r.city)&&t.push(r.id);return t}mutateCarriages(e){let t=[];if(this.carriagesDataAllUpd)for(let r=0;r<e.length;r+=1){let o=e[r];for(let s=0;s<this.carriagesDataAllUpd.length;s+=1){let M=this.carriagesDataAllUpd[s];M.code&&M.name===o&&t.push(M.code)}}return t}resetForm(){this.stations.clear(),this.carriages.clear(),this.stations.push(new p(null)),this.carriages.push(new p(null))}closeForm(){this.formClosed.emit()}setInitialValues(){if(this.routeData){let e=this.routeData.path||[];this.stations.clear(),e.forEach(r=>{let o=this.stationDataAllUpd?.find(s=>s.id===r);this.stations.push(new p(o?o.city:null))}),this.stations.push(new p(null));let t=this.routeData.carriages||[];this.carriages.clear(),t.forEach(r=>{let o=this.carriagesDataAllUpd?.find(s=>s.code===r);this.carriages.push(new p(o?o.name:null))}),this.carriages.push(new p(null))}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-upd-route-form"]],inputs:{routeData:"routeData",stationDataAllUpd:"stationDataAllUpd",carriagesDataAllUpd:"carriagesDataAllUpd"},outputs:{formClosed:"formClosed"},standalone:!0,features:[S],decls:14,vars:1,consts:[[1,"upd-route-from",3,"formGroup"],[1,"upd-route-from__wrapper"],["formArrayName","stations",1,"upd-route-from__station"],[1,"upd-route-from__stations-container"],["formArrayName","carriages",1,"upd-route-from__carriages"],[1,"upd-route-from__carriages-container"],["size","s","tuiButton","",3,"click"],["tuiTextfieldSize","s",3,"ngModelChange","formControlName"],["placeholder","Choose your hero","tuiTextfieldLegacy",""],[3,"items",4,"tuiDataList"],["size","s","tuiButton","",1,"upd-route-from__delete-button",3,"click"],[3,"items"]],template:function(t,r){t&1&&(a(0,"form",0)(1,"div",1)(2,"div",2)(3,"h2"),c(4,"Select citys"),n(),D(5,Ft,7,1,"div",3,I),n(),a(7,"div",4)(8,"h2"),c(9,"Select carriages"),n(),D(10,yt,7,1,"div",5,I),n()(),a(12,"button",6),m("click",function(){return r.createRoute()}),c(13,"Update route"),n()()),t&2&&(f("formGroup",r.updRouteForm),u(5),F(r.stations.controls),u(5),F(r.carriages.controls))},dependencies:[q,L,B,N,j,z,G,Z,J,Y,Q,X,H,K,b,w],styles:[".upd-route-from[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;align-items:flex-start;justify-content:center;margin-bottom:50px}.upd-route-from__wrapper[_ngcontent-%COMP%]{display:flex;flex:1;gap:5px;align-items:flex-start;justify-content:center;width:100%}.upd-route-from__station[_ngcontent-%COMP%], .upd-route-from__carriages[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;gap:5px}.upd-route-from__station[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%], .upd-route-from__carriages[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%]{width:calc(100% - 60px)}.upd-route-from__carriages-container[_ngcontent-%COMP%], .upd-route-from__stations-container[_ngcontent-%COMP%]{display:flex;align-items:center}.upd-route-from__delete-button[_ngcontent-%COMP%]{width:50px}button[_ngcontent-%COMP%]{width:80vw;margin:2.5px}"]})};function St(i,e){if(i&1&&(a(0,"div"),c(1),n()),i&2){let t=e.$implicit;u(),U("- ",t," -")}}function wt(i,e){if(i&1&&(a(0,"div"),c(1),n()),i&2){let t=l().$implicit;u(),U("- ",t.city," -")}}function bt(i,e){if(i&1&&g(0,wt,2,1,"div"),i&2){let t=e.$implicit;R(t?0:-1)}}function At(i,e){if(i&1){let t=x();a(0,"app-upd-route-form",5),m("formClosed",function(){d(t);let o=l();return _(o.closeRoutesCreateForm())}),n(),a(1,"button",4),m("click",function(){d(t);let o=l();return _(o.closeRoutesCreateForm())}),c(2,"Close update"),n()}if(i&2){let t=l();f("routeData",t.routeData)("stationDataAllUpd",t.stationDataAll)("carriagesDataAllUpd",t.carriagesDataAll)}}function Tt(i,e){if(i&1){let t=x();a(0,"button",4),m("click",function(){d(t);let o=l();return _(o.openRoutesUpdForm())}),c(1,"Update"),n()}}var et=class i{routeData;stationData;stationDataAll;carriagesDataAll;store=h(A);isRoutesUpdFormOpen=!1;deleteRoute(){this.routeData.id&&this.store.dispatch(T.deleteRoute({pickRoute:this.routeData.id}))}openRoutesUpdForm(){this.isRoutesUpdFormOpen=!0}closeRoutesCreateForm(){this.isRoutesUpdFormOpen=!1}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-route-card"]],inputs:{routeData:"routeData",stationData:"stationData",stationDataAll:"stationDataAll",carriagesDataAll:"carriagesDataAll"},standalone:!0,features:[S],decls:21,vars:4,consts:[[1,"route-card"],[1,"route-card__carriage-arr"],[1,"route-card__station-arr"],["size","s","tuiButton",""],["size","s","tuiButton","",3,"click"],[3,"formClosed","routeData","stationDataAllUpd","carriagesDataAllUpd"]],template:function(t,r){t&1&&(a(0,"div",0)(1,"h2"),c(2),n(),a(3,"div")(4,"h3"),c(5,"Carriages:"),n(),a(6,"div",1),D(7,St,2,1,"div",null,ot),n()(),a(9,"h3"),c(10,"Citys:"),n(),a(11,"div",2),D(12,bt,1,1,null,null,ot),O(14,"async"),n(),g(15,At,3,3)(16,Tt,2,0,"button",3),a(17,"button",3),c(18,"Asign ride"),n(),a(19,"button",4),m("click",function(){return r.deleteRoute()}),c(20,"Delete"),n()()),t&2&&(u(2),U("Route ",r.routeData.id,""),u(5),F(r.routeData.carriages),u(5),F(k(14,2,r.stationData)),u(3),R(r.isRoutesUpdFormOpen?15:16))},dependencies:[w,$,b,tt],styles:[".route-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;justify-content:center;width:80vw;padding:20px;border:1px solid gray;border-radius:10px}.route-card__carriage-arr[_ngcontent-%COMP%], .route-card__station-arr[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap}button[_ngcontent-%COMP%]{width:80vw}"]})};function Mt(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=l(2);f("items",t.processedStationData)}}function It(i,e){if(i&1){let t=x();a(0,"div",3)(1,"tui-select",7),m("ngModelChange",function(){let o=d(t).$index,s=l();return _(s.onSelectChangeStation(o))}),c(2," City "),C(3,"input",8),g(4,Mt,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=d(t).$index,s=l();return _(s.removeStation(o))}),c(6,"delete"),n()()}if(i&2){let t=e.$index;u(),f("formControlName",t)}}function Ot(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=l(2);f("items",t.processedCarriagesData)}}function kt(i,e){if(i&1){let t=x();a(0,"div",5)(1,"tui-select",7),m("ngModelChange",function(){let o=d(t).$index,s=l();return _(s.onSelectChangeCarriages(o))}),c(2," Carriage "),C(3,"input",8),g(4,Ot,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=d(t).$index,s=l();return _(s.removeCarriage(o))}),c(6," delete "),n()()}if(i&2){let t=e.$index;u(),f("formControlName",t)}}var it=class i{formClosed=new P;stationData;carriagesData;store=h(A);formBuilder=h(W);createRouteForm=this.formBuilder.group({stations:this.formBuilder.array([new p(null)]),carriages:this.formBuilder.array([new p(null)])});get stations(){return this.createRouteForm.get("stations")}get carriages(){return this.createRouteForm.get("carriages")}get processedStationData(){return this.stationData?this.stationData.map(e=>e.city):null}get processedCarriagesData(){return this.carriagesData?this.carriagesData.map(e=>e.name):null}onSelectChangeStation(e){e===this.stations.length-1&&this.stations.push(new p(null))}onSelectChangeCarriages(e){e===this.carriages.length-1&&this.carriages.push(new p(null))}removeStation(e){this.stations.length>1&&this.stations.removeAt(e)}removeCarriage(e){this.carriages.length>1&&this.carriages.removeAt(e)}createRoute(){let e=this.mutateStations(Array.from(new Set(this.createRouteForm.get("stations")?.value.slice(0,-1)))),t=this.mutateCarriages(this.createRouteForm.get("carriages")?.value.filter(o=>o!==null));if(e.length<=1){alert("add at least two stations");return}if(t.length===0){alert("add at least one carriages");return}let r={path:e,carriages:t};this.store.dispatch(T.addNewRoute({newRoute:r})),this.resetForm()}mutateStations(e){let t=[];if(this.stationData)for(let r of this.stationData)e.includes(r.city)&&t.push(r.id);return t}mutateCarriages(e){let t=[];if(this.carriagesData)for(let r=0;r<e.length;r+=1){let o=e[r];for(let s=0;s<this.carriagesData.length;s+=1){let M=this.carriagesData[s];M.code&&M.name===o&&t.push(M.code)}}return t}closeForm(){this.formClosed.emit()}resetForm(){this.stations.clear(),this.carriages.clear(),this.stations.push(new p(null)),this.carriages.push(new p(null))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-create-route-form"]],inputs:{stationData:"stationData",carriagesData:"carriagesData"},outputs:{formClosed:"formClosed"},standalone:!0,features:[S],decls:16,vars:1,consts:[[1,"create-route-from",3,"formGroup"],[1,"create-route-from__wrapper"],["formArrayName","stations",1,"create-route-from__station"],[1,"create-route-from__stations-container"],["formArrayName","carriages",1,"create-route-from__carriages"],[1,"create-route-from__carriages-container"],["size","s","tuiButton","",3,"click"],["tuiTextfieldSize","s",3,"ngModelChange","formControlName"],["placeholder","Choose your hero","tuiTextfieldLegacy",""],[3,"items",4,"tuiDataList"],["size","s","tuiButton","",1,"create-route-from__delete-button",3,"click"],[3,"items"]],template:function(t,r){t&1&&(a(0,"form",0)(1,"div",1)(2,"div",2)(3,"h2"),c(4,"Select citys"),n(),D(5,It,7,1,"div",3,I),n(),a(7,"div",4)(8,"h2"),c(9,"Select carriages"),n(),D(10,kt,7,1,"div",5,I),n()(),a(12,"button",6),m("click",function(){return r.createRoute()}),c(13,"Add route"),n()(),a(14,"button",6),m("click",function(){return r.closeForm()}),c(15,"Close create form"),n()),t&2&&(f("formGroup",r.createRouteForm),u(5),F(r.stations.controls),u(5),F(r.carriages.controls))},dependencies:[q,L,B,N,j,z,G,Z,J,Y,Q,X,H,K,b,w],styles:[".create-route-from[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;align-items:flex-start;justify-content:center}.create-route-from__wrapper[_ngcontent-%COMP%]{display:flex;flex:1;gap:5px;align-items:flex-start;justify-content:center;width:100%}.create-route-from__station[_ngcontent-%COMP%], .create-route-from__carriages[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;gap:5px}.create-route-from__station[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%], .create-route-from__carriages[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%]{width:calc(100% - 60px)}.create-route-from__carriages-container[_ngcontent-%COMP%], .create-route-from__stations-container[_ngcontent-%COMP%]{display:flex;align-items:center}.create-route-from__delete-button[_ngcontent-%COMP%]{width:50px}button[_ngcontent-%COMP%]{width:80vw;margin:2.5px}"],changeDetection:0})};var Pt=(i,e)=>e.id;function Ut(i,e){if(i&1){let t=x();a(0,"app-create-route-form",2),m("formClosed",function(){d(t);let o=l(2);return _(o.closeRoutesCreateForm())}),n()}if(i&2){l(2);let t=v(0),r=v(2);f("stationData",r)("carriagesData",t)}}function Et(i,e){if(i&1&&g(0,Ut,1,2,"app-create-route-form",1),i&2){l();let t=v(0),r=v(2);R(r&&t?0:-1)}}function Vt(i,e){if(i&1){let t=x();a(0,"button",3),m("click",function(){d(t);let o=l();return _(o.openRoutesCreateForm())}),c(1,"Create"),n()}}function $t(i,e){if(i&1&&C(0,"app-route-card",4),i&2){let t=l().$implicit,r=l(2),o=v(0),s=v(2);f("routeData",t)("stationData",r.getCitiesByIds(t.path))("stationDataAll",s)("carriagesDataAll",o)}}function Bt(i,e){if(i&1&&g(0,$t,1,4,"app-route-card",4),i&2){l(2);let t=v(0),r=v(2);R(r&&t?0:-1)}}function Nt(i,e){if(i&1&&D(0,Bt,1,1,null,null,Pt),i&2){l();let t=v(6);F(t)}}var dt=class i{adminService=h(ct);store=h(A);routesList$=this.store.select(pt);stationArr$=this.store.select(ut);carriagesArr$=this.store.select(mt);isRoutesCreateFormOpen=!1;ngOnInit(){this.store.dispatch(T.loadRoutesAndStations())}openRoutesCreateForm(){this.isRoutesCreateFormOpen=!0}closeRoutesCreateForm(){this.isRoutesCreateFormOpen=!1}getCitiesByIds(e){return this.stationArr$.pipe(rt(t=>t.filter(r=>e.includes(r.id))),st())}getCarriagesByCode(e){return this.carriagesArr$.pipe(rt(t=>t.filter(r=>{r.code&&e.includes(r.code)})))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=y({type:i,selectors:[["app-routes"]],standalone:!0,features:[S],decls:9,vars:11,consts:[["size","s","tuiButton",""],[3,"stationData","carriagesData"],[3,"formClosed","stationData","carriagesData"],["size","s","tuiButton","",3,"click"],[3,"routeData","stationData","stationDataAll","carriagesDataAll"]],template:function(t,r){if(t&1&&(E(0),O(1,"async"),E(2),O(3,"async"),g(4,Et,1,1)(5,Vt,2,0,"button",0),E(6),O(7,"async"),g(8,Nt,2,0)),t&2){V(k(1,2,r.carriagesArr$)),u(2),V(k(3,5,r.stationArr$)),u(2),R(r.isRoutesCreateFormOpen?4:5),u(2);let o=V(k(7,8,r.routesList$));u(2),R(o?8:-1)}},dependencies:[b,w,$,et,it],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center}button[_ngcontent-%COMP%]{width:80vw}"]})};export{dt as RoutesComponent};
